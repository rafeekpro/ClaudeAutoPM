#!/bin/bash
# Validate ClaudeAutoPM project integrity

echo "ðŸ” Validating ClaudeAutoPM Project..."
echo ""

# Use code-analyzer agent for validation
echo "ðŸ“‹ Validation Checklist:"

# 1. Check agent registry
echo -n "  â”œâ”€â”€ Agent registry... "
if [ -f autopm/.claude/agents/AGENT-REGISTRY.md ]; then
    node scripts/self-maintenance.js validate >/dev/null 2>&1 && echo "âœ…" || echo "âŒ"
else
    echo "âŒ (not found)"
fi

# 2. Check configuration
echo -n "  â”œâ”€â”€ Configuration... "
if [ -f .claude/config.json ] && [ -f CLAUDE.md ]; then
    echo "âœ…"
else
    echo "âŒ"
fi

# 3. Check installation script
echo -n "  â”œâ”€â”€ Installation script... "
if [ -f install/install.sh ]; then
    echo "âœ…"
else
    echo "âŒ"
fi

# 4. Check documentation
echo -n "  â”œâ”€â”€ Documentation... "
if [ -f README.md ] && [ -f PLAYBOOK.md ] && [ -f CHANGELOG.md ]; then
    echo "âœ…"
else
    echo "âŒ"
fi

# 5. Verify agent configuration
echo -n "  â””â”€â”€ Agent configuration... "
node scripts/verify-agents.js >/dev/null 2>&1 && echo "âœ…" || echo "âŒ"

echo ""
echo "ðŸ§ª Running quick tests..."

# Run npm test if available
if [ -f package.json ]; then
    npm test --silent 2>/dev/null && echo "  âœ… Tests passing" || echo "  âŒ Some tests failing"
fi

echo ""
echo "ðŸ“Š Code Analysis:"

# Count total files
total_files=$(find autopm -type f -name "*.md" -o -name "*.js" -o -name "*.sh" 2>/dev/null | wc -l)
echo "  â”œâ”€â”€ Total files: $total_files"

# Count agents
total_agents=$(find autopm/.claude/agents -name "*.md" -not -path "*/templates/*" 2>/dev/null | wc -l)
echo "  â”œâ”€â”€ Total agents: $total_agents"

# Check for TODOs
todos=$(grep -r "TODO" autopm 2>/dev/null | wc -l)
echo "  â””â”€â”€ TODOs found: $todos"

echo ""
echo "âœ… Validation complete"
echo ""
echo "For detailed analysis, run:"
echo "  - 'pm optimize' for optimization opportunities"
echo "  - 'pm health' for system health report"
echo "  - 'node scripts/verify-agents.js' for agent verification"