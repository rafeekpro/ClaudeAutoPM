#!/bin/bash
# Validate ClaudeAutoPM project integrity

echo "🔍 Validating ClaudeAutoPM Project..."
echo ""

# Use code-analyzer agent for validation
echo "📋 Validation Checklist:"

# 1. Check agent registry
echo -n "  ├── Agent registry... "
if [ -f autopm/.claude/agents/AGENT-REGISTRY.md ]; then
    node scripts/self-maintenance.js validate >/dev/null 2>&1 && echo "✅" || echo "❌"
else
    echo "❌ (not found)"
fi

# 2. Check configuration
echo -n "  ├── Configuration... "
if [ -f .claude/config.json ] && [ -f CLAUDE.md ]; then
    echo "✅"
else
    echo "❌"
fi

# 3. Check installation script
echo -n "  ├── Installation script... "
if [ -f install/install.sh ]; then
    echo "✅"
else
    echo "❌"
fi

# 4. Check documentation
echo -n "  ├── Documentation... "
if [ -f README.md ] && [ -f PLAYBOOK.md ] && [ -f CHANGELOG.md ]; then
    echo "✅"
else
    echo "❌"
fi

# 5. Verify agent configuration
echo -n "  └── Agent configuration... "
node scripts/verify-agents.js >/dev/null 2>&1 && echo "✅" || echo "❌"

echo ""
echo "🧪 Running quick tests..."

# Run npm test if available
if [ -f package.json ]; then
    npm test --silent 2>/dev/null && echo "  ✅ Tests passing" || echo "  ❌ Some tests failing"
fi

echo ""
echo "📊 Code Analysis:"

# Count total files
total_files=$(find autopm -type f -name "*.md" -o -name "*.js" -o -name "*.sh" 2>/dev/null | wc -l)
echo "  ├── Total files: $total_files"

# Count agents
total_agents=$(find autopm/.claude/agents -name "*.md" -not -path "*/templates/*" 2>/dev/null | wc -l)
echo "  ├── Total agents: $total_agents"

# Check for TODOs
todos=$(grep -r "TODO" autopm 2>/dev/null | wc -l)
echo "  └── TODOs found: $todos"

echo ""
echo "✅ Validation complete"
echo ""
echo "For detailed analysis, run:"
echo "  - 'pm optimize' for optimization opportunities"
echo "  - 'pm health' for system health report"
echo "  - 'node scripts/verify-agents.js' for agent verification"